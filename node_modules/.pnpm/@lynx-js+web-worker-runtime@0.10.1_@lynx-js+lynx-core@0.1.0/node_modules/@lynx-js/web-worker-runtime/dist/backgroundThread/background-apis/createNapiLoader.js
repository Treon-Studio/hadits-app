// Copyright 2023 The Lynx Authors. All rights reserved.
// Licensed under the Apache License Version 2.0 that can be found in the
// LICENSE file in the root directory of this source tree.
import { dispatchNapiModuleEndpoint, napiModulesCallEndpoint, } from '@lynx-js/web-constants';
export const createNapiLoader = async (rpc, napiModulesMap) => {
    const napiModulesCall = rpc.createCall(napiModulesCallEndpoint);
    const napiModules = {};
    await Promise.all(Object.entries(napiModulesMap).map(([moduleName, moduleStr]) => import(/* webpackIgnore: true */ moduleStr).then(module => napiModules[moduleName] = module?.default?.(napiModules, (name, data) => napiModulesCall(name, data, moduleName), (func) => {
        rpc.registerHandler(dispatchNapiModuleEndpoint, (data) => func(data));
    }))));
    return {
        load(moduleName) {
            return napiModules[moduleName];
        },
    };
};
//# sourceMappingURL=createNapiLoader.js.map